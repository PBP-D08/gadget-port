{% extends 'base.html' %} 
{% load static %} 
{% block content %}
<div class="container mx-auto">
  <h1 class="text-4xl font-bold text-blue-600 text-center mb-10">Products</h1>

  <!-- Display katalog list -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 mb-16">
    {% for katalog in katalogs %}
    <div class="bg-white shadow-lg rounded-lg overflow-hidden transition duration-300 transform hover:scale-105">
      <img src="{{ katalog.image_url }}" alt="{{ katalog.name }}" class="w-full h-64 object-cover" />
      <div class="p-5">
        <h2 class="text-2xl font-bold mb-2 text-gray-800">{{ katalog.name }}</h2>
        <p class="text-gray-600">{{ katalog.description|truncatewords:20 }}</p>
        <p class="text-blue-600 font-semibold mt-3">Price: ${{ katalog.price }}</p>
        <button
          onclick="addToWishlist({{ katalog.id }}, '{{ katalog.name }}')"
          class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300"
        >
          Add to Wishlist
        </button>
      </div>
    </div>
    {% endfor %}
  </div>

  <h1 class="text-4xl font-bold text-blue-600 text-center mb-10">My Wishlist</h1>

  <!-- Display wishlist items -->
  {% if wishlist_items %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
    {% for item in wishlist_items %}
    <div id="wishlist-item-{{ item.id }}" class="wishlist-item bg-white shadow-lg rounded-lg overflow-hidden transition duration-300 transform hover:scale-105">
      <img src="{{ item.katalog.image_url }}" alt="{{ item.katalog.name }}" class="w-full h-64 object-cover" />
      <div class="p-5">
        <h2 class="text-2xl font-bold mb-2 text-gray-800">{{ item.katalog.name }}</h2>
        <p class="text-gray-600">{{ item.katalog.description|truncatewords:20 }}</p>
        <p class="text-blue-600 font-semibold mt-3">Price: ${{ item.katalog.price }}</p>
        <button
          onclick="confirmDelete({{ item.id }}, '{{ item.katalog.name }}')"
          class="remove-button w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition duration-300"
        >
          Remove from Wishlist
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-gray-600 mt-10">Your wishlist is currently empty.</p>
  {% endif %}
</div>

<!-- JavaScript for handling wishlist actions -->
<script>
  function addToWishlist(katalogId, katalogName) {
    fetch("{% url 'wishlist:add_wishlist' katalog_id='0' %}".replace('0', katalogId), {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        name: katalogName,
      }),
    })
      .then((response) => {
        if (response.ok) {
          alert(`${katalogName} has been added to your wishlist.`);
        } else if (response.status === 409) {
          alert(`${katalogName} is already in your wishlist.`);
        } else {
          alert("Failed to add item. Please try again.");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("An error occurred. Please try again.");
      });
  }

  function confirmDelete(itemId, itemName) {
    const userConfirm = confirm(`Are you sure you want to remove "${itemName}" from your wishlist?`);
    if (userConfirm) {
      deleteWishlistItem(itemId);
    }
  }

  function deleteWishlistItem(itemId) {
    fetch(`{% url 'wishlist:delete_wishlist' 0 %}`.replace(0, itemId), {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/json",
      },
    })
      .then((response) => {
        if (response.ok) {
          // Remove the item from the DOM
          document.getElementById(`wishlist-item-${itemId}`).remove();
          alert("Item removed from your wishlist.");
        } else {
          alert("Failed to remove item. Please try again.");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("An error occurred. Please try again.");
      });
  }
</script>
{% endblock %}
